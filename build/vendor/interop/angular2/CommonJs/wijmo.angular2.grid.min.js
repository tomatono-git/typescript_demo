/*
    *
    * Wijmo Library 5.20172.359
    * http://wijmo.com/
    *
    * Copyright(c) GrapeCity, Inc.  All rights reserved.
    *
    * Licensed under the GrapeCity Commercial License.
    * sales@wijmo.com
    * wijmo.com/products/wijmo-5/license/
    *
    */
"use strict";var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,t){n.__proto__=t}||function(n,t){for(var i in t)t.hasOwnProperty(i)&&(n[i]=t[i])};return function(t,i){function r(){this.constructor=t}n(t,i);t.prototype=i===null?Object.create(i):(r.prototype=i.prototype,new r)}}(),__decorate=this&&this.__decorate||function(n,t,i,r){var f=arguments.length,u=f<3?t:r===null?r=Object.getOwnPropertyDescriptor(t,i):r,e,o;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")u=Reflect.decorate(n,t,i,r);else for(o=n.length-1;o>=0;o--)(e=n[o])&&(u=(f<3?e(u):f>3?e(t,i,u):e(t,i))||u);return f>3&&u&&Object.defineProperty(t,i,u),u},__param=this&&this.__param||function(n,t){return function(i,r){t(i,r,n)}},WjFlexGrid,WjFlexGridColumn,WjFlexGridCellTemplate,CellTemplateType,DirectiveCellFactory,moduleExports,WjGridModule,WjFlexGrid_1,WjFlexGridColumn_1,WjFlexGridCellTemplate_1;Object.defineProperty(exports,"__esModule",{value:!0});var core_1=require("@angular/core"),core_2=require("@angular/core"),core_3=require("@angular/core"),common_1=require("@angular/common"),forms_1=require("@angular/forms"),wijmo_angular2_directiveBase_1=require("wijmo/wijmo.angular2.directiveBase");exports.wjFlexGridMeta={selector:'wj-flex-grid',template:"<div><ng-content></ng-content></div>",inputs:['wjModelProperty','isDisabled','newRowAtTop','allowAddNew','allowDelete','allowDragging','allowMerging','allowResizing','allowSorting','autoSizeMode','autoGenerateColumns','childItemsPath','groupHeaderFormat','headersVisibility','showSelectedHeaders','showMarquee','itemFormatter','isReadOnly','imeEnabled','mergeManager','selectionMode','showGroups','showSort','showDropDown','showAlternatingRows','showErrors','validateEdits','treeIndent','itemsSource','autoClipboard','frozenRows','frozenColumns','deferResizing','sortRowIndex','stickyHeaders','preserveSelectedState','preserveOutlineState','keyActionTab','keyActionEnter','rowHeaderPath','virtualizationThreshold',],outputs:['initialized','gotFocusNg: gotFocus','lostFocusNg: lostFocus','beginningEditNg: beginningEdit','cellEditEndedNg: cellEditEnded','cellEditEndingNg: cellEditEnding','prepareCellForEditNg: prepareCellForEdit','formatItemNg: formatItem','resizingColumnNg: resizingColumn','resizedColumnNg: resizedColumn','autoSizingColumnNg: autoSizingColumn','autoSizedColumnNg: autoSizedColumn','draggingColumnNg: draggingColumn','draggingColumnOverNg: draggingColumnOver','draggedColumnNg: draggedColumn','sortingColumnNg: sortingColumn','sortedColumnNg: sortedColumn','resizingRowNg: resizingRow','resizedRowNg: resizedRow','autoSizingRowNg: autoSizingRow','autoSizedRowNg: autoSizedRow','draggingRowNg: draggingRow','draggingRowOverNg: draggingRowOver','draggedRowNg: draggedRow','deletingRowNg: deletingRow','deletedRowNg: deletedRow','loadingRowsNg: loadingRows','loadedRowsNg: loadedRows','rowEditStartingNg: rowEditStarting','rowEditStartedNg: rowEditStarted','rowEditEndingNg: rowEditEnding','rowEditEndedNg: rowEditEnded','rowAddedNg: rowAdded','groupCollapsedChangedNg: groupCollapsedChanged','groupCollapsedChangingNg: groupCollapsedChanging','itemsSourceChangedNg: itemsSourceChanged','selectionChangingNg: selectionChanging','selectionChangedNg: selectionChanged','scrollPositionChangedNg: scrollPositionChanged','updatingViewNg: updatingView','updatedViewNg: updatedView','updatingLayoutNg: updatingLayout','updatedLayoutNg: updatedLayout','pastingNg: pasting','pastedNg: pasted','pastingCellNg: pastingCell','pastedCellNg: pastedCell','copyingNg: copying','copiedNg: copied',],providers:[{provide:forms_1.NG_VALUE_ACCESSOR,useFactory:wijmo_angular2_directiveBase_1.WjValueAccessorFactory,multi:!0,deps:['WjComponent']}]};WjFlexGrid=WjFlexGrid_1=function(n){function t(t,i,r,u){var f=n.call(this,wijmo_angular2_directiveBase_1.WjDirectiveBehavior.getHostElement(t,i))||this,e;return f.isInitialized=!1,e=f._wjBehaviour=wijmo_angular2_directiveBase_1.WjDirectiveBehavior.attach(f,t,i,r),new DirectiveCellFactory(f,u),f.deferUpdate(function(){if(f.rows.defaultSize<10){var t=f.hostElement,i=getComputedStyle(t),r=getComputedStyle(document.body),n=parseInt(i.fontSize&&wijmo.contains(document.body,t)?i.fontSize:r.fontSize)*2;f.rows.defaultSize=n;f.columns.defaultSize=n*4;f.columnHeaders.rows.defaultSize=n;f.rowHeaders.columns.defaultSize=Math.round(n*1.25)}}),f.created(),f}return __extends(t,n),t.prototype.created=function(){},t.prototype.ngOnInit=function(){this._wjBehaviour.ngOnInit()},t.prototype.ngAfterViewInit=function(){this._wjBehaviour.ngAfterViewInit()},t.prototype.ngOnDestroy=function(){this._wjBehaviour.ngOnDestroy()},t.prototype.addEventListener=function(t,i,r,u){var o=this,f,e;u===void 0&&(u=!1);f=wijmo_angular2_directiveBase_1.WjDirectiveBehavior;e=f.ngZone;e&&f.outsideZoneEvents[i]?e.runOutsideAngular(function(){n.prototype.addEventListener.call(o,t,i,r,u)}):n.prototype.addEventListener.call(this,t,i,r,u)},t}(wijmo.grid.FlexGrid);WjFlexGrid.meta={outputs:exports.wjFlexGridMeta.outputs};WjFlexGrid=WjFlexGrid_1=__decorate([core_1.Component({selector:exports.wjFlexGridMeta.selector,template:exports.wjFlexGridMeta.template,inputs:exports.wjFlexGridMeta.inputs,outputs:exports.wjFlexGridMeta.outputs,providers:[{provide:'WjComponent',useExisting:core_2.forwardRef(function(){return WjFlexGrid_1})}].concat(exports.wjFlexGridMeta.providers)}),__param(0,core_3.Inject(core_2.ElementRef)),__param(1,core_3.Inject(core_2.Injector)),__param(2,core_3.Inject('WjComponent')),__param(2,core_3.SkipSelf()),__param(2,core_2.Optional()),__param(3,core_3.Inject(core_3.ChangeDetectorRef))],WjFlexGrid);exports.WjFlexGrid=WjFlexGrid;exports.wjFlexGridColumnMeta={selector:'wj-flex-grid-column',template:"<div><ng-content></ng-content></div>",inputs:['asyncBindings','wjProperty','name','dataMap','dataType','binding','sortMemberPath','format','header','width','maxLength','minWidth','maxWidth','align','allowDragging','allowSorting','allowResizing','allowMerging','aggregate','isReadOnly','cssClass','isContentHtml','isSelected','visible','wordWrap','mask','inputType','isRequired','showDropDown','dropDownCssClass',],outputs:['initialized','isSelectedChangePC: isSelectedChange',],providers:[]};WjFlexGridColumn=WjFlexGridColumn_1=function(n){function t(t,i,r){var u=n.call(this)||this,e,f;return u.isInitialized=!1,u.wjProperty='columns',e=u._wjBehaviour=wijmo_angular2_directiveBase_1.WjDirectiveBehavior.attach(u,t,i,r),f=e.parentBehavior.directive,f.autoGenerateColumns&&(f.autoGenerateColumns=!1,f.columns.clear()),u.created(),u}return __extends(t,n),t.prototype.created=function(){},t.prototype.ngOnInit=function(){this._wjBehaviour.ngOnInit()},t.prototype.ngAfterViewInit=function(){this._wjBehaviour.ngAfterViewInit()},t.prototype.ngOnDestroy=function(){this._wjBehaviour.ngOnDestroy()},t}(wijmo.grid.Column);WjFlexGridColumn.meta={outputs:exports.wjFlexGridColumnMeta.outputs,changeEvents:{'grid.selectionChanged':['isSelected']}};WjFlexGridColumn=WjFlexGridColumn_1=__decorate([core_1.Component({selector:exports.wjFlexGridColumnMeta.selector,template:exports.wjFlexGridColumnMeta.template,inputs:exports.wjFlexGridColumnMeta.inputs,outputs:exports.wjFlexGridColumnMeta.outputs,providers:[{provide:'WjComponent',useExisting:core_2.forwardRef(function(){return WjFlexGridColumn_1})}].concat(exports.wjFlexGridColumnMeta.providers)}),__param(0,core_3.Inject(core_2.ElementRef)),__param(1,core_3.Inject(core_2.Injector)),__param(2,core_3.Inject('WjComponent')),__param(2,core_3.SkipSelf()),__param(2,core_2.Optional())],WjFlexGridColumn);exports.WjFlexGridColumn=WjFlexGridColumn;WjFlexGridCellTemplate=WjFlexGridCellTemplate_1=function(){function n(n,t,i,r,u,f,e){this.viewContainerRef=n;this.templateRef=t;this.elRef=i;this.domRenderer=u;this.cdRef=e;this.autoSizeRows=!0;r instanceof WjFlexGrid?this.grid=r:r instanceof WjFlexGridColumn&&(this.column=r,this.grid=wijmo_angular2_directiveBase_1.WjDirectiveBehavior.getBehavior(r).parentBehavior.directive)}return n._getTemplContextProp=function(n){return'$__cellTempl'+CellTemplateType[n]},n.prototype.ngOnInit=function(){this.ownerControl=this.column&&this.column.grid===this.grid?this.column:this.grid;this._attachToControl()},n.prototype.ngOnDestroy=function(){this.cellTypeStr&&(this.viewContainerRef.clear(),this.ownerControl[WjFlexGridCellTemplate_1._getTemplContextProp(this.cellType)]=null,this.grid.invalidate())},n.prototype._instantiateTemplate=function(n){return wijmo_angular2_directiveBase_1.WjDirectiveBehavior.instantiateTemplate(n,this.viewContainerRef,this.templateRef,this.domRenderer)},n.prototype._attachToControl=function(){this.cellTypeStr&&(this.cellType=wijmo.asEnum(this.cellTypeStr,CellTemplateType),this.ownerControl[WjFlexGridCellTemplate_1._getTemplContextProp(this.cellType)]=this,this.grid.invalidate())},n}();WjFlexGridCellTemplate=WjFlexGridCellTemplate_1=__decorate([core_2.Directive({selector:'[wjFlexGridCellTemplate]',inputs:['wjFlexGridCellTemplate','cellTypeStr: cellType','cellOverflow','valuePaths','autoSizeRows'],exportAs:'wjFlexGridCellTemplate',providers:[{provide:'WjComponent',useExisting:core_2.forwardRef(function(){return WjFlexGridCellTemplate_1})}]}),__param(0,core_3.Inject(core_2.ViewContainerRef)),__param(1,core_3.Inject(core_2.TemplateRef)),__param(1,core_2.Optional()),__param(2,core_3.Inject(core_2.ElementRef)),__param(3,core_3.Inject('WjComponent')),__param(3,core_3.SkipSelf()),__param(3,core_2.Optional()),__param(4,core_3.Inject(core_2.Renderer)),__param(5,core_3.Inject(core_2.Injector)),__param(6,core_3.Inject(core_3.ChangeDetectorRef))],WjFlexGridCellTemplate);exports.WjFlexGridCellTemplate=WjFlexGridCellTemplate,function(n){n[n.Cell=0]="Cell";n[n.CellEdit=1]="CellEdit";n[n.ColumnHeader=2]="ColumnHeader";n[n.RowHeader=3]="RowHeader";n[n.RowHeaderEdit=4]="RowHeaderEdit";n[n.TopLeft=5]="TopLeft";n[n.GroupHeader=6]="GroupHeader";n[n.Group=7]="Group";n[n.NewCellTemplate=8]="NewCellTemplate";n[n.ColumnFooter=9]="ColumnFooter";n[n.BottomLeft=10]="BottomLeft"}(CellTemplateType=exports.CellTemplateType||(exports.CellTemplateType={}));DirectiveCellFactory=function(n){function t(i,r){var u=n.call(this)||this,e,f;if(u._needsCdCheck=!1,u._lastApplyTimeStamp=0,u._noApplyLag=!1,u._startingEditing=!1,u._cellStampCounter=0,u._composing=!1,u.grid=i,u._gridCdRef=r,!t._templateTypes){t._templateTypes=[];for(e in CellTemplateType)isNaN(e)&&t._templateTypes.push(e)}return f=u,u._baseCf=i.cellFactory,i.cellFactory=u,u._evtInput=document.createEvent('HTMLEvents'),u._evtInput.initEvent('input',!0,!1),u._evtBlur=document.createEvent('HTMLEvents'),u._evtBlur.initEvent('blur',!1,!1),i.prepareCellForEdit.addHandler(function(){f._noApplyLag=!0}),i.cellEditEnded.addHandler(function(n,t){(t.range.col<0||t.range.col<i.columns.length&&!i.columns[t.range.col][WjFlexGridCellTemplate._getTemplContextProp(CellTemplateType.CellEdit)])&&(f._editChar=null);setTimeout(function(){f._noApplyLag=!1},300)}),i.beginningEdit.addHandler(function(){f._startingEditing=!0}),i.hostElement.addEventListener('keydown',function(){f._startingEditing=!1},!0),i.hostElement.addEventListener('keypress',function(n){var t=n.charCode>32?String.fromCharCode(n.charCode):null;t&&(!i.activeEditor||f._startingEditing?f._editChar=t:f._editChar&&(f._editChar+=t))},!0),i.hostElement.addEventListener('compositionstart',function(){f._composing=!0},!0),i.hostElement.addEventListener('compositionend',function(){f._composing=!1},!0),i.updatedView.addHandler(function(){u._needsCdCheck&&(u._needsCdCheck=!1,u._gridCdRef.markForCheck())},u),u}return __extends(t,n),t.prototype.updateCell=function(n,i,r,u,f){var g=this,ht,tt,it,a,c,h,ct,lt,rt,at,ft,et,y,ot,st;this._cellStampCounter=(this._cellStampCounter+1)%1e7;ht=u[t._cellStampProp]=this._cellStampCounter;u.style.overflow&&(u.style.overflow='');var p=this,o=n.grid,nt=o.editRange,e,v=n.rows[i],w=v.dataItem,b=!1,k=!1,l=!1,d=!1;switch(n.cellType){case wijmo.grid.CellType.Cell:nt&&nt.row===i&&nt.col===r?(e=CellTemplateType.CellEdit,k=l=!0):v instanceof wijmo.grid.GroupRow?(d=w instanceof wijmo.collections.CollectionViewGroup,tt=!(d||v.hasChildren),r==n.columns.firstVisibleIndex?e=tt?CellTemplateType.Cell:CellTemplateType.GroupHeader:(e=tt?CellTemplateType.Cell:CellTemplateType.Group,k=!0)):v instanceof wijmo.grid._NewRowTemplate?e=CellTemplateType.NewCellTemplate:wijmo.grid.detail&&wijmo.grid.detail.DetailRow&&v instanceof wijmo.grid.detail.DetailRow||(e=CellTemplateType.Cell);break;case wijmo.grid.CellType.ColumnHeader:e=CellTemplateType.ColumnHeader;break;case wijmo.grid.CellType.RowHeader:e=o.collectionView&&o.collectionView.currentEditItem===w?CellTemplateType.RowHeaderEdit:CellTemplateType.RowHeader;b=!0;break;case wijmo.grid.CellType.TopLeft:e=CellTemplateType.TopLeft;b=!0;break;case wijmo.grid.CellType.ColumnFooter:e=CellTemplateType.ColumnFooter;k=!0;break;case wijmo.grid.CellType.BottomLeft:e=CellTemplateType.BottomLeft;b=!0}if(it=!1,e!=null&&(a=d&&e==CellTemplateType.GroupHeader?o.columns.getColumn(w.groupDescription.propertyName):r>=0&&r<n.columns.length?n.columns[r]:null,a&&(c=WjFlexGridCellTemplate._getTemplContextProp(e),h=(b?o:a)[c],h||(e===CellTemplateType.RowHeaderEdit?(e=CellTemplateType.RowHeader,c=WjFlexGridCellTemplate._getTemplContextProp(e),h=o[c]):(e===CellTemplateType.Group||e===CellTemplateType.GroupHeader)&&(d||(e=CellTemplateType.Cell,c=WjFlexGridCellTemplate._getTemplContextProp(e),h=a[c]))),h&&(ct=!0,k&&(lt=n.getCellData(i,r,!1)),ct)))){it=!0;rt=u.getAttribute(wijmo.grid.FlexGrid._WJS_MEASURE);at=rt&&rt.toLowerCase()==='true';l&&this._baseCf.updateCell(n,i,r,u,f,!0);var s=u[c]||{},vt=s.column!==a||!s.viewRef||s.templateContextProperty!==c||u.firstChild!=s.rootElement,ut=l&&this._composing&&o.imeEnabled;vt&&(l?(ft=u.firstElementChild,ft&&(ut||u.focus(),ft.style.display='none')):u.textContent='',this._doDisposeCell(u),et=h._instantiateTemplate(u),s.column=a,s.viewRef=et.viewRef,s.rootElement=et.rootElement,s.templateContextProperty=c,u[c]=s);y=this._setViewRefVars(s.viewRef,v,a,w,lt,h.valuePaths);h.cellOverflow&&(u.style.overflow=h.cellOverflow);at?h.cdRef.detectChanges():h.autoSizeRows&&!ut?setTimeout(function(){if(ht===u[t._cellStampProp]){var e=u.scrollHeight,r=n.rows,h=f&&f.rowSpan||1;if(i<r.length&&r[i].renderHeight*h<e-1){if(r.defaultSize=e/h,l){o.refresh();o.startEditing();return}}else l&&g._initEditInput(s,null)}},0):l&&setTimeout(function(){ut?g._initImeEditInput(s):g._initEditInput(s,null)},0);l?(p._cellEditorVars=y.localVars,ot=function(n,t){var r,s,h,i,f,e,c;if(o.cellEditEnding.removeHandler(ot),t.stayInEditMode||(r=wijmo.getActiveElement(),r&&r.dispatchEvent(p._evtBlur),u.focus()),p._triggerEditorEvents(u),!(t.cancel||t.stayInEditMode))for(s=y.localVars,h=Object.getOwnPropertyNames(y.bindings),i=0,f=h;i<f.length;i++)e=f[i],y.bindings[e].setValue(s,y.localVars.values[e]);c=u.querySelectorAll('.wj-dropdown');[].forEach.call(c,function(n){var t=wijmo.Control.getControl(n);t&&wijmo.input&&t instanceof wijmo.input.DropDown&&(t.isDroppedDown=!1)})},st=function(){o.cellEditEnded.removeHandler(st);p._cellEditorVars=null},o.cellEditEnding.addHandler(ot),o.cellEditEnded.addHandler(st)):this._baseCf.updateCell(n,i,r,u,f,!1)}it||(this._doDisposeCell(u),this._baseCf.updateCell(n,i,r,u,f))},t.prototype.getEditorValue=function(t){if(this._cellEditorVars){var i=t.editRange;return i&&i.isValid&&this._triggerEditorEvents(t.cells.getCellElement(i.row,i.col)),this._cellEditorVars.value}return n.prototype.getEditorValue.call(this,t)},t.prototype.disposeCell=function(n){this._doDisposeCell(n)},t.prototype._doDisposeCell=function(n){for(var r,i,s,u,e,o=t._templateTypes,f=0;f<o.length;f++)r=WjFlexGridCellTemplate._getTemplContextProp(CellTemplateType[o[f]]),i=n[r],i&&i.viewRef&&(s=i.column||this.grid,u=s[r],u&&(e=u.viewContainerRef.indexOf(i.viewRef),e>-1&&u.viewContainerRef.remove(e)),i.viewRef=null,i.rootElement=null,i.column=null,i.templateContextProperty=null,n[r]=null)},t.prototype._setViewRefVars=function(n,t,i,r,u,f){var v,o,h,s,c;this._needsCdCheck=!0;n.context.row=t;n.context.col=i;n.context.item=r;var l={},e=n.context.cell||{},a={},y={localVars:e,bindings:a};if(e.row=t,e.col=i,e.item=r,e.value=u,e.values=l,f)for(v=Object.getOwnPropertyNames(f),o=0,h=v;o<h.length;o++)s=h[o],c=new wijmo.Binding(f[s]),a[s]=c,l[s]=c.getValue(e);return n.context.cell!==e&&(n.context.cell=e),y},t.prototype._initEditInput=function(n,t){var r=this,i=this._findInitialInput(n),f=window.getComputedStyle(i),u;f.display!=='none'&&f.visibility==='visible'&&(u=function(){i.removeEventListener('focus',u);setTimeout(function(){setTimeout(function(){var n=t!=null?t:r._editChar,u,f;n&&(u=!0,f=i.selectionStart+n.length,i.value=n,r._editChar=null,i.dispatchEvent(r._evtInput),u&&setTimeout(function(){setTimeout(function(){wijmo.setSelectionRange(i,Math.min(f,i.value.length),i.value.length)},0)},0))},0)},0)},i.addEventListener('focus',u),i.focus())},t.prototype._initImeEditInput=function(n){var o=this,t=wijmo.getActiveElement(),r,u;if(t&&t instanceof HTMLInputElement&&wijmo.hasClass(t,'wj-grid-ime')&&(r=function(){t.removeEventListener('compositionend',r);wijmo.setCss(t,wijmo.grid._ImeHandler._cssHidden);o._initEditInput(n,t.value)},t.addEventListener('compositionend',r),u=this._findInitialInput(n),u)){var i=u.getBoundingClientRect(),f=t.getBoundingClientRect(),e=window.getComputedStyle(t),s=parseFloat(e.left),h=parseFloat(e.top);wijmo.setCss(t,{left:s+i.left-f.left+'px',top:h+i.top-f.top+'px',width:i.width+'px',height:i.height+'px'})}},t.prototype._findInitialInput=function(n){var i=n&&n.rootElement&&n.rootElement.querySelectorAll('input'),t,r,u;if(i)for(t=0;t<i.length;t++)if(r=i[t],u=window.getComputedStyle(r),u.display!=='none'&&u.visibility==='visible')return r;return null},t.prototype._triggerEditorEvents=function(n){var i,t,f,r,u;if(n)for(i=n.querySelectorAll('.wj-control'),t=0;t<i.length;t++)f=i[t],r=wijmo.Control.getControl(f),r&&(u=wijmo_angular2_directiveBase_1.WjDirectiveBehavior.getBehavior(r),u&&u.flushPendingEvents())},t}(wijmo.grid.CellFactory);DirectiveCellFactory._cellStampProp='__wjCellStamp';moduleExports=[WjFlexGrid,WjFlexGridColumn,WjFlexGridCellTemplate];WjGridModule=function(){function n(){}return n}();WjGridModule=__decorate([core_1.NgModule({imports:[wijmo_angular2_directiveBase_1.WjDirectiveBaseModule,common_1.CommonModule],declarations:moduleExports.slice(),exports:moduleExports.slice()})],WjGridModule);exports.WjGridModule=WjGridModule