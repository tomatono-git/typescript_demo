/*
    *
    * Wijmo Library 5.20172.359
    * http://wijmo.com/
    *
    * Copyright(c) GrapeCity, Inc.  All rights reserved.
    *
    * Licensed under the GrapeCity Commercial License.
    * sales@wijmo.com
    * wijmo.com/products/wijmo-5/license/
    *
    */
System.register("wijmo/wijmo.angular2.grid",["@angular/core","@angular/common","@angular/forms","wijmo/wijmo.angular2.directiveBase"],function(n,t){"use strict";var w=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,t){n.__proto__=t}||function(n,t){for(var i in t)t.hasOwnProperty(i)&&(n[i]=t[i])};return function(t,i){function r(){this.constructor=t}n(t,i);t.prototype=i===null?Object.create(i):(r.prototype=i.prototype,new r)}}(),v=this&&this.__decorate||function(n,t,i,r){var f=arguments.length,u=f<3?t:r===null?r=Object.getOwnPropertyDescriptor(t,i):r,e,o;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")u=Reflect.decorate(n,t,i,r);else for(o=n.length-1;o>=0;o--)(e=n[o])&&(u=(f<3?e(u):f>3?e(t,i,u):e(t,i))||u);return f>3&&u&&Object.defineProperty(t,i,u),u},r=this&&this.__param||function(n,t){return function(i,r){t(i,r,n)}},it=t&&t.id,y,f,u,nt,tt,e,s,h,c,l,o,i,b,k,p,d,g,a;return{setters:[function(n){y=n;f=n;u=n},function(n){nt=n},function(n){tt=n},function(n){e=n}],execute:function(){n("wjFlexGridMeta",s={selector:'wj-flex-grid',template:"<div><ng-content></ng-content></div>",inputs:['wjModelProperty','isDisabled','newRowAtTop','allowAddNew','allowDelete','allowDragging','allowMerging','allowResizing','allowSorting','autoSizeMode','autoGenerateColumns','childItemsPath','groupHeaderFormat','headersVisibility','showSelectedHeaders','showMarquee','itemFormatter','isReadOnly','imeEnabled','mergeManager','selectionMode','showGroups','showSort','showDropDown','showAlternatingRows','showErrors','validateEdits','treeIndent','itemsSource','autoClipboard','frozenRows','frozenColumns','deferResizing','sortRowIndex','stickyHeaders','preserveSelectedState','preserveOutlineState','keyActionTab','keyActionEnter','rowHeaderPath','virtualizationThreshold',],outputs:['initialized','gotFocusNg: gotFocus','lostFocusNg: lostFocus','beginningEditNg: beginningEdit','cellEditEndedNg: cellEditEnded','cellEditEndingNg: cellEditEnding','prepareCellForEditNg: prepareCellForEdit','formatItemNg: formatItem','resizingColumnNg: resizingColumn','resizedColumnNg: resizedColumn','autoSizingColumnNg: autoSizingColumn','autoSizedColumnNg: autoSizedColumn','draggingColumnNg: draggingColumn','draggingColumnOverNg: draggingColumnOver','draggedColumnNg: draggedColumn','sortingColumnNg: sortingColumn','sortedColumnNg: sortedColumn','resizingRowNg: resizingRow','resizedRowNg: resizedRow','autoSizingRowNg: autoSizingRow','autoSizedRowNg: autoSizedRow','draggingRowNg: draggingRow','draggingRowOverNg: draggingRowOver','draggedRowNg: draggedRow','deletingRowNg: deletingRow','deletedRowNg: deletedRow','loadingRowsNg: loadingRows','loadedRowsNg: loadedRows','rowEditStartingNg: rowEditStarting','rowEditStartedNg: rowEditStarted','rowEditEndingNg: rowEditEnding','rowEditEndedNg: rowEditEnded','rowAddedNg: rowAdded','groupCollapsedChangedNg: groupCollapsedChanged','groupCollapsedChangingNg: groupCollapsedChanging','itemsSourceChangedNg: itemsSourceChanged','selectionChangingNg: selectionChanging','selectionChangedNg: selectionChanged','scrollPositionChangedNg: scrollPositionChanged','updatingViewNg: updatingView','updatedViewNg: updatedView','updatingLayoutNg: updatingLayout','updatedLayoutNg: updatedLayout','pastingNg: pasting','pastedNg: pasted','pastingCellNg: pastingCell','pastedCellNg: pastedCell','copyingNg: copying','copiedNg: copied',],providers:[{provide:tt.NG_VALUE_ACCESSOR,useFactory:e.WjValueAccessorFactory,multi:!0,deps:['WjComponent']}]});h=d=function(n){function t(t,i,r,u){var f=n.call(this,e.WjDirectiveBehavior.getHostElement(t,i))||this,o;return f.isInitialized=!1,o=f._wjBehaviour=e.WjDirectiveBehavior.attach(f,t,i,r),new b(f,u),f.deferUpdate(function(){if(f.rows.defaultSize<10){var t=f.hostElement,i=getComputedStyle(t),r=getComputedStyle(document.body),n=parseInt(i.fontSize&&wijmo.contains(document.body,t)?i.fontSize:r.fontSize)*2;f.rows.defaultSize=n;f.columns.defaultSize=n*4;f.columnHeaders.rows.defaultSize=n;f.rowHeaders.columns.defaultSize=Math.round(n*1.25)}}),f.created(),f}return w(t,n),t.prototype.created=function(){},t.prototype.ngOnInit=function(){this._wjBehaviour.ngOnInit()},t.prototype.ngAfterViewInit=function(){this._wjBehaviour.ngAfterViewInit()},t.prototype.ngOnDestroy=function(){this._wjBehaviour.ngOnDestroy()},t.prototype.addEventListener=function(t,i,r,u){var s=this,f,o;u===void 0&&(u=!1);f=e.WjDirectiveBehavior;o=f.ngZone;o&&f.outsideZoneEvents[i]?o.runOutsideAngular(function(){n.prototype.addEventListener.call(s,t,i,r,u)}):n.prototype.addEventListener.call(this,t,i,r,u)},t}(wijmo.grid.FlexGrid);h.meta={outputs:s.outputs};h=d=v([y.Component({selector:s.selector,template:s.template,inputs:s.inputs,outputs:s.outputs,providers:[{provide:'WjComponent',useExisting:f.forwardRef(function(){return d})}].concat(s.providers)}),r(0,u.Inject(f.ElementRef)),r(1,u.Inject(f.Injector)),r(2,u.Inject('WjComponent')),r(2,u.SkipSelf()),r(2,f.Optional()),r(3,u.Inject(u.ChangeDetectorRef))],h);n("WjFlexGrid",h);n("wjFlexGridColumnMeta",c={selector:'wj-flex-grid-column',template:"<div><ng-content></ng-content></div>",inputs:['asyncBindings','wjProperty','name','dataMap','dataType','binding','sortMemberPath','format','header','width','maxLength','minWidth','maxWidth','align','allowDragging','allowSorting','allowResizing','allowMerging','aggregate','isReadOnly','cssClass','isContentHtml','isSelected','visible','wordWrap','mask','inputType','isRequired','showDropDown','dropDownCssClass',],outputs:['initialized','isSelectedChangePC: isSelectedChange',],providers:[]});l=g=function(n){function t(t,i,r){var u=n.call(this)||this,o,f;return u.isInitialized=!1,u.wjProperty='columns',o=u._wjBehaviour=e.WjDirectiveBehavior.attach(u,t,i,r),f=o.parentBehavior.directive,f.autoGenerateColumns&&(f.autoGenerateColumns=!1,f.columns.clear()),u.created(),u}return w(t,n),t.prototype.created=function(){},t.prototype.ngOnInit=function(){this._wjBehaviour.ngOnInit()},t.prototype.ngAfterViewInit=function(){this._wjBehaviour.ngAfterViewInit()},t.prototype.ngOnDestroy=function(){this._wjBehaviour.ngOnDestroy()},t}(wijmo.grid.Column);l.meta={outputs:c.outputs,changeEvents:{'grid.selectionChanged':['isSelected']}};l=g=v([y.Component({selector:c.selector,template:c.template,inputs:c.inputs,outputs:c.outputs,providers:[{provide:'WjComponent',useExisting:f.forwardRef(function(){return g})}].concat(c.providers)}),r(0,u.Inject(f.ElementRef)),r(1,u.Inject(f.Injector)),r(2,u.Inject('WjComponent')),r(2,u.SkipSelf()),r(2,f.Optional())],l);n("WjFlexGridColumn",l);o=a=function(){function n(n,t,i,r,u,f,o){this.viewContainerRef=n;this.templateRef=t;this.elRef=i;this.domRenderer=u;this.cdRef=o;this.autoSizeRows=!0;r instanceof h?this.grid=r:r instanceof l&&(this.column=r,this.grid=e.WjDirectiveBehavior.getBehavior(r).parentBehavior.directive)}return n._getTemplContextProp=function(n){return'$__cellTempl'+i[n]},n.prototype.ngOnInit=function(){this.ownerControl=this.column&&this.column.grid===this.grid?this.column:this.grid;this._attachToControl()},n.prototype.ngOnDestroy=function(){this.cellTypeStr&&(this.viewContainerRef.clear(),this.ownerControl[a._getTemplContextProp(this.cellType)]=null,this.grid.invalidate())},n.prototype._instantiateTemplate=function(n){return e.WjDirectiveBehavior.instantiateTemplate(n,this.viewContainerRef,this.templateRef,this.domRenderer)},n.prototype._attachToControl=function(){this.cellTypeStr&&(this.cellType=wijmo.asEnum(this.cellTypeStr,i),this.ownerControl[a._getTemplContextProp(this.cellType)]=this,this.grid.invalidate())},n}();o=a=v([f.Directive({selector:'[wjFlexGridCellTemplate]',inputs:['wjFlexGridCellTemplate','cellTypeStr: cellType','cellOverflow','valuePaths','autoSizeRows'],exportAs:'wjFlexGridCellTemplate',providers:[{provide:'WjComponent',useExisting:f.forwardRef(function(){return a})}]}),r(0,u.Inject(f.ViewContainerRef)),r(1,u.Inject(f.TemplateRef)),r(1,f.Optional()),r(2,u.Inject(f.ElementRef)),r(3,u.Inject('WjComponent')),r(3,u.SkipSelf()),r(3,f.Optional()),r(4,u.Inject(f.Renderer)),r(5,u.Inject(f.Injector)),r(6,u.Inject(u.ChangeDetectorRef))],o);n("WjFlexGridCellTemplate",o),function(n){n[n.Cell=0]="Cell";n[n.CellEdit=1]="CellEdit";n[n.ColumnHeader=2]="ColumnHeader";n[n.RowHeader=3]="RowHeader";n[n.RowHeaderEdit=4]="RowHeaderEdit";n[n.TopLeft=5]="TopLeft";n[n.GroupHeader=6]="GroupHeader";n[n.Group=7]="Group";n[n.NewCellTemplate=8]="NewCellTemplate";n[n.ColumnFooter=9]="ColumnFooter";n[n.BottomLeft=10]="BottomLeft"}(i||(i={}));n("CellTemplateType",i);b=function(n){function t(r,u){var f=n.call(this)||this,s,e;if(f._needsCdCheck=!1,f._lastApplyTimeStamp=0,f._noApplyLag=!1,f._startingEditing=!1,f._cellStampCounter=0,f._composing=!1,f.grid=r,f._gridCdRef=u,!t._templateTypes){t._templateTypes=[];for(s in i)isNaN(s)&&t._templateTypes.push(s)}return e=f,f._baseCf=r.cellFactory,r.cellFactory=f,f._evtInput=document.createEvent('HTMLEvents'),f._evtInput.initEvent('input',!0,!1),f._evtBlur=document.createEvent('HTMLEvents'),f._evtBlur.initEvent('blur',!1,!1),r.prepareCellForEdit.addHandler(function(){e._noApplyLag=!0}),r.cellEditEnded.addHandler(function(n,t){(t.range.col<0||t.range.col<r.columns.length&&!r.columns[t.range.col][o._getTemplContextProp(i.CellEdit)])&&(e._editChar=null);setTimeout(function(){e._noApplyLag=!1},300)}),r.beginningEdit.addHandler(function(){e._startingEditing=!0}),r.hostElement.addEventListener('keydown',function(){e._startingEditing=!1},!0),r.hostElement.addEventListener('keypress',function(n){var t=n.charCode>32?String.fromCharCode(n.charCode):null;t&&(!r.activeEditor||e._startingEditing?e._editChar=t:e._editChar&&(e._editChar+=t))},!0),r.hostElement.addEventListener('compositionstart',function(){e._composing=!0},!0),r.hostElement.addEventListener('compositionend',function(){e._composing=!1},!0),r.updatedView.addHandler(function(){f._needsCdCheck&&(f._needsCdCheck=!1,f._gridCdRef.markForCheck())},f),f}return w(t,n),t.prototype.updateCell=function(n,r,u,f,e){var tt=this,lt,rt,ut,y,a,l,at,vt,ft,yt,ot,st,w,ht,ct;this._cellStampCounter=(this._cellStampCounter+1)%1e7;lt=f[t._cellStampProp]=this._cellStampCounter;f.style.overflow&&(f.style.overflow='');var b=this,h=n.grid,it=h.editRange,s,p=n.rows[r],k=p.dataItem,d=!1,g=!1,v=!1,nt=!1;switch(n.cellType){case wijmo.grid.CellType.Cell:it&&it.row===r&&it.col===u?(s=i.CellEdit,g=v=!0):p instanceof wijmo.grid.GroupRow?(nt=k instanceof wijmo.collections.CollectionViewGroup,rt=!(nt||p.hasChildren),u==n.columns.firstVisibleIndex?s=rt?i.Cell:i.GroupHeader:(s=rt?i.Cell:i.Group,g=!0)):p instanceof wijmo.grid._NewRowTemplate?s=i.NewCellTemplate:wijmo.grid.detail&&wijmo.grid.detail.DetailRow&&p instanceof wijmo.grid.detail.DetailRow||(s=i.Cell);break;case wijmo.grid.CellType.ColumnHeader:s=i.ColumnHeader;break;case wijmo.grid.CellType.RowHeader:s=h.collectionView&&h.collectionView.currentEditItem===k?i.RowHeaderEdit:i.RowHeader;d=!0;break;case wijmo.grid.CellType.TopLeft:s=i.TopLeft;d=!0;break;case wijmo.grid.CellType.ColumnFooter:s=i.ColumnFooter;g=!0;break;case wijmo.grid.CellType.BottomLeft:s=i.BottomLeft;d=!0}if(ut=!1,s!=null&&(y=nt&&s==i.GroupHeader?h.columns.getColumn(k.groupDescription.propertyName):u>=0&&u<n.columns.length?n.columns[u]:null,y&&(a=o._getTemplContextProp(s),l=(d?h:y)[a],l||(s===i.RowHeaderEdit?(s=i.RowHeader,a=o._getTemplContextProp(s),l=h[a]):(s===i.Group||s===i.GroupHeader)&&(nt||(s=i.Cell,a=o._getTemplContextProp(s),l=y[a]))),l&&(at=!0,g&&(vt=n.getCellData(r,u,!1)),at)))){ut=!0;ft=f.getAttribute(wijmo.grid.FlexGrid._WJS_MEASURE);yt=ft&&ft.toLowerCase()==='true';v&&this._baseCf.updateCell(n,r,u,f,e,!0);var c=f[a]||{},pt=c.column!==y||!c.viewRef||c.templateContextProperty!==a||f.firstChild!=c.rootElement,et=v&&this._composing&&h.imeEnabled;pt&&(v?(ot=f.firstElementChild,ot&&(et||f.focus(),ot.style.display='none')):f.textContent='',this._doDisposeCell(f),st=l._instantiateTemplate(f),c.column=y,c.viewRef=st.viewRef,c.rootElement=st.rootElement,c.templateContextProperty=a,f[a]=c);w=this._setViewRefVars(c.viewRef,p,y,k,vt,l.valuePaths);l.cellOverflow&&(f.style.overflow=l.cellOverflow);yt?l.cdRef.detectChanges():l.autoSizeRows&&!et?setTimeout(function(){if(lt===f[t._cellStampProp]){var u=f.scrollHeight,i=n.rows,o=e&&e.rowSpan||1;if(r<i.length&&i[r].renderHeight*o<u-1){if(i.defaultSize=u/o,v){h.refresh();h.startEditing();return}}else v&&tt._initEditInput(c,null)}},0):v&&setTimeout(function(){et?tt._initImeEditInput(c):tt._initEditInput(c,null)},0);v?(b._cellEditorVars=w.localVars,ht=function(n,t){var r,o,s,i,u,e,c;if(h.cellEditEnding.removeHandler(ht),t.stayInEditMode||(r=wijmo.getActiveElement(),r&&r.dispatchEvent(b._evtBlur),f.focus()),b._triggerEditorEvents(f),!(t.cancel||t.stayInEditMode))for(o=w.localVars,s=Object.getOwnPropertyNames(w.bindings),i=0,u=s;i<u.length;i++)e=u[i],w.bindings[e].setValue(o,w.localVars.values[e]);c=f.querySelectorAll('.wj-dropdown');[].forEach.call(c,function(n){var t=wijmo.Control.getControl(n);t&&wijmo.input&&t instanceof wijmo.input.DropDown&&(t.isDroppedDown=!1)})},ct=function(){h.cellEditEnded.removeHandler(ct);b._cellEditorVars=null},h.cellEditEnding.addHandler(ht),h.cellEditEnded.addHandler(ct)):this._baseCf.updateCell(n,r,u,f,e,!1)}ut||(this._doDisposeCell(f),this._baseCf.updateCell(n,r,u,f,e))},t.prototype.getEditorValue=function(t){if(this._cellEditorVars){var i=t.editRange;return i&&i.isValid&&this._triggerEditorEvents(t.cells.getCellElement(i.row,i.col)),this._cellEditorVars.value}return n.prototype.getEditorValue.call(this,t)},t.prototype.disposeCell=function(n){this._doDisposeCell(n)},t.prototype._doDisposeCell=function(n){for(var u,r,c,f,s,h=t._templateTypes,e=0;e<h.length;e++)u=o._getTemplContextProp(i[h[e]]),r=n[u],r&&r.viewRef&&(c=r.column||this.grid,f=c[u],f&&(s=f.viewContainerRef.indexOf(r.viewRef),s>-1&&f.viewContainerRef.remove(s)),r.viewRef=null,r.rootElement=null,r.column=null,r.templateContextProperty=null,n[u]=null)},t.prototype._setViewRefVars=function(n,t,i,r,u,f){var v,o,h,s,c;this._needsCdCheck=!0;n.context.row=t;n.context.col=i;n.context.item=r;var l={},e=n.context.cell||{},a={},y={localVars:e,bindings:a};if(e.row=t,e.col=i,e.item=r,e.value=u,e.values=l,f)for(v=Object.getOwnPropertyNames(f),o=0,h=v;o<h.length;o++)s=h[o],c=new wijmo.Binding(f[s]),a[s]=c,l[s]=c.getValue(e);return n.context.cell!==e&&(n.context.cell=e),y},t.prototype._initEditInput=function(n,t){var r=this,i=this._findInitialInput(n),f=window.getComputedStyle(i),u;f.display!=='none'&&f.visibility==='visible'&&(u=function(){i.removeEventListener('focus',u);setTimeout(function(){setTimeout(function(){var n=t!=null?t:r._editChar,u,f;n&&(u=!0,f=i.selectionStart+n.length,i.value=n,r._editChar=null,i.dispatchEvent(r._evtInput),u&&setTimeout(function(){setTimeout(function(){wijmo.setSelectionRange(i,Math.min(f,i.value.length),i.value.length)},0)},0))},0)},0)},i.addEventListener('focus',u),i.focus())},t.prototype._initImeEditInput=function(n){var o=this,t=wijmo.getActiveElement(),r,u;if(t&&t instanceof HTMLInputElement&&wijmo.hasClass(t,'wj-grid-ime')&&(r=function(){t.removeEventListener('compositionend',r);wijmo.setCss(t,wijmo.grid._ImeHandler._cssHidden);o._initEditInput(n,t.value)},t.addEventListener('compositionend',r),u=this._findInitialInput(n),u)){var i=u.getBoundingClientRect(),f=t.getBoundingClientRect(),e=window.getComputedStyle(t),s=parseFloat(e.left),h=parseFloat(e.top);wijmo.setCss(t,{left:s+i.left-f.left+'px',top:h+i.top-f.top+'px',width:i.width+'px',height:i.height+'px'})}},t.prototype._findInitialInput=function(n){var i=n&&n.rootElement&&n.rootElement.querySelectorAll('input'),t,r,u;if(i)for(t=0;t<i.length;t++)if(r=i[t],u=window.getComputedStyle(r),u.display!=='none'&&u.visibility==='visible')return r;return null},t.prototype._triggerEditorEvents=function(n){var i,t,f,r,u;if(n)for(i=n.querySelectorAll('.wj-control'),t=0;t<i.length;t++)f=i[t],r=wijmo.Control.getControl(f),r&&(u=e.WjDirectiveBehavior.getBehavior(r),u&&u.flushPendingEvents())},t}(wijmo.grid.CellFactory);b._cellStampProp='__wjCellStamp';k=[h,l,o];p=function(){function n(){}return n}();p=v([y.NgModule({imports:[e.WjDirectiveBaseModule,nt.CommonModule],declarations:k.slice(),exports:k.slice()})],p);n("WjGridModule",p)}}})